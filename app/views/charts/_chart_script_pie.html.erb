<script src="https://d3js.org/d3.v4.min.js"></script>

<% colors_hash = {
  "yellow": "#FFDB29",
  "orange": "#FD7366",
  "red": "#F04F2B",
  "blue": "#30C2FF",
  "purple": "#9E60F8",
  "green": "#3EC28F",
  "gray": "#000000",
  "light gray": "#F4F4F4",
  "medium dark gray": "#1A1A1A",
  "dark gray": "#141414"
}
%>

<script>

var data = <%= chart.datasets.order(:created_at).to_json.html_safe %>;

var svg = d3.select("#chart-<%= chart.id %> > svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height"),
    radius = Math.min(width, height) / 2,
    g = svg.append("g").attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

var color = d3.scaleOrdinal(["yellow", "blue", "red", "green", "orange", "purple", "gray"]);

var pie = d3.pie()
    .sort(null)
    .value(function(d) { return d.value; });

var path = d3.arc()
    .outerRadius(radius - 10)
    .innerRadius(0);

var label = d3.arc()
    .outerRadius(radius - 40)
    .innerRadius(radius - 40);

var arc = g.selectAll(".arc")
  .data(pie(data))
  .enter().append("g")
    .attr("class", "arc");

arc.append("path")
    .attr("d", path)
    .attr("fill", function(d) { return color(d.data.label); });

arc.append("text")
    .attr("transform", function(d) { return "translate(" + label.centroid(d) + ")"; })
    .attr("dy", "0.35em")
    .text(function(d) { return d.data.label; });

</script>
