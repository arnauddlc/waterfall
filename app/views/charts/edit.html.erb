<div class="main-container">
  <div class="container">
    <div class="row">
      <div class="col-xs-6">
        <ul class="nav nav-tabs">
          <li class="active"><a data-toggle="tab" href="#data">DATA</a></li>
          <li><a data-toggle="tab" href="#design">DESIGN</a></li>
          <li><a data-toggle="tab" href="#notes">NOTES</a></li>
        </ul>

        <div class="tab-content">
          <div id="data" class="tab-pane fade in active">
            <div id="data-sets-table">
              <div class="table-heading">
                <div class="table-cell">
                  <p>LABEL</p>
                </div>
                <div class="table-cell">
                  <p>VALUE</p>
                </div>
              </div>
              <% @chart.datasets.each do |dataset| %>
                <div class="table-row">
                  <div class="table-cell">
                    <p><%= "#{dataset.label}" %></p>
                  </div>
                  <div class="table-cell">
                    <p><%= "#{dataset.value}" %></p>
                  </div>
                  <div class="table-cell-s edit-delete">
                    <%= link_to "" do %>
                      <%= image_tag "pencil.svg" %>
                    <% end %>
                    <%= link_to image_tag("trash-simple.svg"), dataset_path(dataset), method: :delete, data: { confirm: "Are you sure? " } %>
                  </div>
                </div>
              <% end %>
            </div>
            <%= render 'datasets/form' %>
          </div>

          <div id="design" class="tab-pane fade">
            <%= render 'design_section' %>
          </div>

          <div id="notes" class="tab-pane fade">
            <%= render 'notes_section' %>
          </div>
        </div>
      </div>

      <div class="col-xs-6">
        <!-- <div id="chart-display"> -->
           <svg width="400" height="400"></svg>
        <!-- </div> -->
        <%= render 'form' %>
      </div>
    </div>
  </div>
</div>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

let data = <%= @chart.datasets.to_json.html_safe %>;

var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height"),
    radius = Math.min(width, height) / 2,
    g = svg.append("g").attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

var color = d3.scaleOrdinal(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

var pie = d3.pie()
    .sort(null)
    .value(function(d) { return d.value; });

var path = d3.arc()
    .outerRadius(radius - 10)
    .innerRadius(0);

var label = d3.arc()
    .outerRadius(radius - 40)
    .innerRadius(radius - 40);

var arc = g.selectAll(".arc")
  .data(pie(data))
  .enter().append("g")
    .attr("class", "arc");

arc.append("path")
    .attr("d", path)
    .attr("fill", function(d) { return color(d.data.label); });

arc.append("text")
    .attr("transform", function(d) { return "translate(" + label.centroid(d) + ")"; })
    .attr("dy", "0.35em")
    .text(function(d) { return d.data.label; });

</script>
