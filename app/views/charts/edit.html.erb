<div class="main-container">
  <div class="container">
    <div class="row">
      <div class="col-xs-6">
        <ul class="nav nav-tabs">
          <li class="active"><a data-toggle="tab" href="#data">DATA</a></li>
          <li><a data-toggle="tab" href="#design">DESIGN</a></li>
          <li><a data-toggle="tab" href="#notes">NOTES</a></li>
        </ul>

        <div class="tab-content">
          <div id="data" class="tab-pane fade in active">
            <div id="data-sets-table">
              <div class="table-heading">
                <div class="table-cell">
                  <p>LABEL</p>
                </div>
                <div class="table-cell">
                  <p>VALUE</p>
                </div>
              </div>
              <% @chart.datasets.each do |dataset| %>
                <div class="table-row">
                  <div class="table-cell">
                    <p><%= "#{dataset.label}" %></p>
                  </div>
                  <div class="table-cell">
                    <p><%= "#{dataset.value}" %></p>
                  </div>
                  <div class="table-cell-s edit-delete">
                    <%= link_to "" do %>
                      <%= image_tag "pencil.svg" %>
                    <% end %>
                    <%= link_to image_tag("trash-simple.svg"), dataset_path(dataset), method: :delete, data: { confirm: "Are you sure? " } %>
                  </div>
                </div>
              <% end %>
            </div>
            <%= render 'datasets/form' %>
          </div>

          <div id="design" class="tab-pane fade">
            <%= render 'design_section' %>
          </div>

          <div id="notes" class="tab-pane fade">
            <%= render 'notes_section' %>
          </div>
        </div>
      </div>

      <div class="col-xs-6">
        <div id="chart-display">
           <svg width="400" height="400"></svg>
        </div>
        <%= render 'form' %>
      </div>
    </div>
  </div>
</div>



<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

let DATA = <%= @chart.datasets.to_json.html_safe %>;

var svg = d3.select("svg"),
    margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = +svg.attr("width") - margin.left - margin.right,
    height = +svg.attr("height") - margin.top - margin.bottom;

var x = d3.scaleBand().rangeRound([0, width]).padding(0.1),
    y = d3.scaleLinear().rangeRound([height, 0]);

var g = svg.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  x.domain(DATA.map(function(d) { return d.label; }));
  y.domain([0, d3.max(DATA, function(d) { return d.value; })]);

  g.append("g")
      .attr("class", "axis axis--x")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));

  g.append("g")
      .attr("class", "axis axis--y")
      .call(d3.axisLeft(y).ticks(10, "%"))
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", "0.71em")
      .attr("text-anchor", "end")
      .text("value");

  g.selectAll(".bar")
    .data(DATA)
    .enter().append("rect")
      .attr("class", "bar")
      .attr("x", function(d) { return x(d.label); })
      .attr("y", function(d) { return y(d.value); })
      .attr("width", x.bandwidth())
      .attr("height", function(d) { return height - y(d.value); });

</script>
